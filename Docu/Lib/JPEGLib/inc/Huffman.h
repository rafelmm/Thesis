/*
 * Huffman.h
 *
 *  Created on: 05/09/2014
 *      Author: miquel
 */

#ifndef HUFFMAN_H_
#define HUFFMAN_H_

#include <string.h>
#define TREE node*

#define ENCODING_LUMA	0
#define ENCODING_CHROMA	1

#define COMPONENT_LUMA 0
#define COMPONENT_CB 1
#define COMPONENT_CR 2

static unsigned char huffman_table_index[3]={0x00,0x11,0x11};

#define HUFFMAN_ALLOC_SIZE sizeof(node)

static const char AC_tree_values_Luma[162] = {
	 0x01 ,0x02,0x03 ,0x00  ,0x04 ,0x11 ,0x05 ,0x12  ,0x21 ,0x31 ,0x41
	      ,0x06 ,0x13 ,0x51  ,0x61 ,0x07 ,0x22 ,0x71  ,0x14 ,0x32 ,0x81
	      ,0x91 ,0xA1 ,0x08  ,0x23 ,0x42 ,0xB1 ,0xC1  ,0x15 ,0x52 ,0xD1
	      ,0xF0 ,0x24 ,0x33  ,0x62 ,0x72 ,0x82 ,0x09  ,0x0A ,0x16 ,0x17
	      ,0x18 ,0x19 ,0x1A  ,0x25 ,0x26 ,0x27 ,0x28  ,0x29 ,0x2A ,0x34
	      ,0x35 ,0x36 ,0x37  ,0x38 ,0x39 ,0x3A ,0x43  ,0x44 ,0x45 ,0x46
	      ,0x47 ,0x48 ,0x49  ,0x4A ,0x53 ,0x54 ,0x55  ,0x56 ,0x57 ,0x58
	      ,0x59 ,0x5A ,0x63  ,0x64 ,0x65 ,0x66 ,0x67  ,0x68 ,0x69 ,0x6A
	      ,0x73 ,0x74 ,0x75  ,0x76 ,0x77 ,0x78 ,0x79  ,0x7A ,0x83 ,0x84
	      ,0x85 ,0x86 ,0x87  ,0x88 ,0x89 ,0x8A ,0x92  ,0x93 ,0x94 ,0x95
	      ,0x96 ,0x97 ,0x98  ,0x99 ,0x9A ,0xA2 ,0xA3  ,0xA4 ,0xA5 ,0xA6
	      ,0xA7 ,0xA8 ,0xA9  ,0xAA ,0xB2 ,0xB3 ,0xB4  ,0xB5 ,0xB6 ,0xB7
	      ,0xB8 ,0xB9 ,0xBA  ,0xC2 ,0xC3 ,0xC4 ,0xC5  ,0xC6 ,0xC7 ,0xC8
	      ,0xC9 ,0xCA ,0xD2  ,0xD3 ,0xD4 ,0xD5 ,0xD6  ,0xD7 ,0xD8 ,0xD9
	      ,0xDA ,0xE1 ,0xE2  ,0xE3 ,0xE4 ,0xE5 ,0xE6  ,0xE7 ,0xE8 ,0xE9
	,0xEA ,0xF1 ,0xF2 ,0xF3 ,0xF4  ,0xF5 ,0xF6 ,0xF7 ,0xF8  ,0xF9 ,0xFA };

static const unsigned char ENCODING_AC_codeLen_Luma[16][11] ={
{4, 3, 4, 6, 8, 10, 13, 15, 18, 25, 26},
{0, 5, 7, 10, 13, 16, 22, 23, 24, 25, 26},
{0, 6, 10, 13, 16, 21, 22, 23, 24, 25, 26},
{0, 7, 11, 15, 20, 21, 22, 23, 24, 25, 26},
{0, 7, 12, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 8, 13, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 8, 14, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 9, 14, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 10, 17, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 10, 18, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 10, 18, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 11, 18, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 11, 18, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 12, 18, 19, 20, 21, 22, 23, 24, 25, 26},
{0, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26},
{11, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26}};




static const char* ENCODING_AC_code_Luma[16][11] = {
{"1010", "00", "01", "100", "1011", "11010", "1111000", "11111000", "1111110110", "1111111110000010", "1111111110000011"},
{"n", "1100", "11011", "1111001", "111110110", "11111110110", "1111111110000100", "1111111110000101", "1111111110000110", "1111111110000111", "1111111110001000"},
{"n", "11100", "11111001", "1111110111", "111111110100", "1111111110001001", "1111111110001010", "1111111110001011", "1111111110001100", "1111111110001101", "1111111110001110"},
{"n", "111010", "111110111", "111111110101", "1111111110001111", "1111111110010000", "1111111110010001", "1111111110010010", "1111111110010011", "1111111110010100", "1111111110010101"},
{"n", "111011", "1111111000", "1111111110010110", "1111111110010111", "1111111110011000", "1111111110011001", "1111111110011010", "1111111110011011", "1111111110011100", "1111111110011101"},
{"n", "1111010", "11111110111", "1111111110011110", "1111111110011111", "1111111110100000", "1111111110100001", "1111111110100010", "1111111110100011", "1111111110100100", "1111111110100101"},
{"n", "1111011", "111111110110", "1111111110100110", "1111111110100111", "1111111110101000", "1111111110101001", "1111111110101010", "1111111110101011", "1111111110101100", "1111111110101101"},
{"n", "11111010", "111111110111", "1111111110101110", "1111111110101111", "1111111110110000", "1111111110110001", "1111111110110010", "1111111110110011", "1111111110110100", "1111111110110101"},
{"n", "111111000", "111111111000000", "1111111110110110", "1111111110110111", "1111111110111000", "1111111110111001", "1111111110111010", "1111111110111011", "1111111110111100", "1111111110111101"},
{"n", "111111001", "1111111110111110", "1111111110111111", "1111111111000000", "1111111111000001", "1111111111000010", "1111111111000011", "1111111111000100", "1111111111000101", "1111111111000110"},
{"n", "111111010", "1111111111000111", "1111111111001000", "1111111111001001", "1111111111001010", "1111111111001011", "1111111111001100", "1111111111001101", "1111111111001110", "1111111111001111"},
{"n", "1111111001", "1111111111010000", "1111111111010001", "1111111111010010", "1111111111010011", "1111111111010100", "1111111111010101", "1111111111010110", "1111111111010111", "1111111111011000"},
{"n", "1111111010", "1111111111011001", "1111111111011010", "1111111111011011", "1111111111011100", "1111111111011101", "1111111111011110", "1111111111011111", "1111111111100000", "1111111111100001"},
{"n", "11111111000", "1111111111100010", "1111111111100011", "1111111111100100", "1111111111100101", "1111111111100110", "1111111111100111", "1111111111101000", "1111111111101001", "1111111111101010"},
{"n", "1111111111101011", "1111111111101100", "1111111111101101", "1111111111101110", "1111111111101111", "1111111111110000", "1111111111110001", "1111111111110010", "1111111111110011", "1111111111110100"},
{"11111111001", "1111111111110101", "1111111111110110", "1111111111110111", "1111111111111000", "1111111111111001", "1111111111111010", "1111111111111011", "1111111111111100", "1111111111111101", "1111111111111110"}};

static const unsigned int bin_AC_code_Luma[16][11] = {
{0b1010,0b00,0b01,0b100,0b1011,0b11010,0b1111000,0b11111000,0b1111110110,0b1111111110000010,0b1111111110000011},
{0b0,0b1100,0b11011,0b1111001,0b111110110,0b11111110110,0b1111111110000100,0b1111111110000101,0b1111111110000110,0b1111111110000111,0b1111111110001000},
{0b0,0b11100,0b11111001,0b1111110111,0b111111110100,0b1111111110001001,0b1111111110001010,0b1111111110001011,0b1111111110001100,0b1111111110001101,0b1111111110001110},
{0b0,0b111010,0b111110111,0b111111110101,0b1111111110001111,0b1111111110010000,0b1111111110010001,0b1111111110010010,0b1111111110010011,0b1111111110010100,0b1111111110010101},
{0b0,0b111011,0b1111111000,0b1111111110010110,0b1111111110010111,0b1111111110011000,0b1111111110011001,0b1111111110011010,0b1111111110011011,0b1111111110011100,0b1111111110011101},
{0b0,0b1111010,0b11111110111,0b1111111110011110,0b1111111110011111,0b1111111110100000,0b1111111110100001,0b1111111110100010,0b1111111110100011,0b1111111110100100,0b1111111110100101},
{0b0,0b1111011,0b111111110110,0b1111111110100110,0b1111111110100111,0b1111111110101000,0b1111111110101001,0b1111111110101010,0b1111111110101011,0b1111111110101100,0b1111111110101101},
{0b0,0b11111010,0b111111110111,0b1111111110101110,0b1111111110101111,0b1111111110110000,0b1111111110110001,0b1111111110110010,0b1111111110110011,0b1111111110110100,0b1111111110110101},
{0b0,0b111111000,0b111111111000000,0b1111111110110110,0b1111111110110111,0b1111111110111000,0b1111111110111001,0b1111111110111010,0b1111111110111011,0b1111111110111100,0b1111111110111101},
{0b0,0b111111001,0b1111111110111110,0b1111111110111111,0b1111111111000000,0b1111111111000001,0b1111111111000010,0b1111111111000011,0b1111111111000100,0b1111111111000101,0b1111111111000110},
{0b0,0b111111010,0b1111111111000111,0b1111111111001000,0b1111111111001001,0b1111111111001010,0b1111111111001011,0b1111111111001100,0b1111111111001101,0b1111111111001110,0b1111111111001111},
{0b0,0b1111111001,0b1111111111010000,0b1111111111010001,0b1111111111010010,0b1111111111010011,0b1111111111010100,0b1111111111010101,0b1111111111010110,0b1111111111010111,0b1111111111011000},
{0b0,0b1111111010,0b1111111111011001,0b1111111111011010,0b1111111111011011,0b1111111111011100,0b1111111111011101,0b1111111111011110,0b1111111111011111,0b1111111111100000,0b1111111111100001},
{0b0,0b11111111000,0b1111111111100010,0b1111111111100011,0b1111111111100100,0b1111111111100101,0b1111111111100110,0b1111111111100111,0b1111111111101000,0b1111111111101001,0b1111111111101010},
{0b0,0b1111111111101011,0b1111111111101100,0b1111111111101101,0b1111111111101110,0b1111111111101111,0b1111111111110000,0b1111111111110001,0b1111111111110010,0b1111111111110011,0b1111111111110100},
{0b11111111001,0b1111111111110101,0b1111111111110110,0b1111111111110111,0b1111111111111000,0b1111111111111001,0b1111111111111010,0b1111111111111011,0b1111111111111100,0b1111111111111101,0b1111111111111110}};



static const char AC_tree_values_Chroma[162] ={ 0x00, 0x01, 0x02, 0x03, 0x11, 0x04, 0x05, 0x21, 0x31, 0x06, 0x12,
		 0x41, 0x51, 0x07, 0x61, 0x71, 0x13, 0x22, 0x32, 0x81, 0x08,
		 0x14, 0x42, 0x91, 0xA1, 0xB1, 0xC1, 0x09, 0x23, 0x33, 0x52,
		 0xF0, 0x15, 0x62, 0x72, 0xD1, 0x0A, 0x16, 0x24, 0x34, 0xE1,
		 0x25, 0xF1, 0x17, 0x18, 0x19, 0x1A, 0x26, 0x27, 0x28, 0x29,
		 0x2A, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3A, 0x43, 0x44, 0x45,
		 0x46, 0x47, 0x48, 0x49, 0x4A, 0x53, 0x54, 0x55, 0x56, 0x57,
		 0x58, 0x59, 0x5A, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69,
		 0x6A, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7A, 0x82,
		 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8A, 0x92, 0x93,
		 0x94, 0x95, 0x96, 0x97, 0x98, 0x99, 0x9A, 0xA2, 0xA3, 0xA4,
		 0xA5, 0xA6, 0xA7, 0xA8, 0xA9, 0xAA, 0xB2, 0xB3, 0xB4, 0xB5,
		 0xB6, 0xB7, 0xB8, 0xB9, 0xBA, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6,
		 0xC7, 0xC8, 0xC9, 0xCA, 0xD2, 0xD3, 0xD4, 0xD5, 0xD6, 0xD7,
		 0xD8, 0xD9, 0xDA, 0xE2, 0xE3, 0xE4, 0xE5, 0xE6, 0xE7, 0xE8,
	   0xE9, 0xEA, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF7, 0xF8, 0xF9, 0xFA};


static const unsigned char ENCODING_AC_codeLen_Chroma[16][11] = {
	{2, 3, 5, 7, 9, 10, 12, 14, 17, 19, 22},
	{0, 5, 8, 11, 13, 16, 18, 23, 24, 25, 26},
	{0, 6, 10, 13, 16, 20, 22, 23, 24, 25, 26},
	{0, 6, 10, 13, 16, 21, 22, 23, 24, 25, 26},
	{0, 7, 11, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 7, 12, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 8, 13, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 8, 13, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 9, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 10, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 10, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 10, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 10, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 12, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{0, 15, 18, 19, 20, 21, 22, 23, 24, 25, 26},
	{10, 16, 18, 19, 20, 21, 22, 23, 24, 25, 26}
};




static const char* ENCODING_AC_code_Chroma[16][11] = {
{"00", "01", "100", "1010", "11000", "11001", "111000", "1111000", "111110100", "1111110110", "111111110100"},
{"n", "1011", "111001", "11110110", "111110101", "11111110110", "111111110101", "1111111110001000", "1111111110001001", "1111111110001010", "1111111110001011"},
{"n", "11010", "11110111", "1111110111", "111111110110", "111111111000010", "1111111110001100", "1111111110001101", "1111111110001110", "1111111110001111", "1111111110010000"},
{"n", "11011", "11111000", "1111111000", "111111110111", "1111111110010001", "1111111110010010", "1111111110010011", "1111111110010100", "1111111110010101", "1111111110010110"},
{"n", "111010", "111110110", "1111111110010111", "1111111110011000", "1111111110011001", "1111111110011010", "1111111110011011", "1111111110011100", "1111111110011101", "1111111110011110"},
{"n", "111011", "1111111001", "1111111110011111", "1111111110100000", "1111111110100001", "1111111110100010", "1111111110100011", "1111111110100100", "1111111110100101", "1111111110100110"},
{"n", "1111001", "11111110111", "1111111110100111", "1111111110101000", "1111111110101001", "1111111110101010", "1111111110101011", "1111111110101100", "1111111110101101", "1111111110101110"},
{"n", "1111010", "11111111000", "1111111110101111", "1111111110110000", "1111111110110001", "1111111110110010", "1111111110110011", "1111111110110100", "1111111110110101", "1111111110110110"},
{"n", "11111001", "1111111110110111", "1111111110111000", "1111111110111001", "1111111110111010", "1111111110111011", "1111111110111100", "1111111110111101", "1111111110111110", "1111111110111111"},
{"n", "111110111", "1111111111000000", "1111111111000001", "1111111111000010", "1111111111000011", "1111111111000100", "1111111111000101", "1111111111000110", "1111111111000111", "1111111111001000"},
{"n", "111111000", "1111111111001001", "1111111111001010", "1111111111001011", "1111111111001100", "1111111111001101", "1111111111001110", "1111111111001111", "1111111111010000", "1111111111010001"},
{"n", "111111001", "1111111111010010", "1111111111010011", "1111111111010100", "1111111111010101", "1111111111010110", "1111111111010111", "1111111111011000", "1111111111011001", "1111111111011010"},
{"n", "111111010", "1111111111011011", "1111111111011100", "1111111111011101", "1111111111011110", "1111111111011111", "1111111111100000", "1111111111100001", "1111111111100010", "1111111111100011"},
{"n", "11111111001", "1111111111100100", "1111111111100101", "1111111111100110", "1111111111100111", "1111111111101000", "1111111111101001", "1111111111101010", "1111111111101011", "1111111111101100"},
{"n", "11111111100000", "1111111111101101", "1111111111101110", "1111111111101111", "1111111111110000", "1111111111110001", "1111111111110010", "1111111111110011", "1111111111110100", "1111111111110101"},
{"1111111010", "111111111000011", "1111111111110110", "1111111111110111", "1111111111111000", "1111111111111001", "1111111111111010", "1111111111111011", "1111111111111100", "1111111111111101", "1111111111111110"}
};

static const unsigned int bin_AC_code_Chroma[16][11] ={
{0b00, 0b01, 0b100, 0b1010, 0b11000, 0b11001, 0b111000, 0b1111000, 0b111110100, 0b1111110110, 0b111111110100},
{0b0, 0b1011, 0b111001, 0b11110110, 0b111110101, 0b11111110110, 0b111111110101, 0b1111111110001000, 0b1111111110001001, 0b1111111110001010, 0b1111111110001011},
{0b0, 0b11010, 0b11110111, 0b1111110111, 0b111111110110, 0b111111111000010, 0b1111111110001100, 0b1111111110001101, 0b1111111110001110, 0b1111111110001111, 0b1111111110010000},
{0b0, 0b11011, 0b11111000, 0b1111111000, 0b111111110111, 0b1111111110010001, 0b1111111110010010, 0b1111111110010011, 0b1111111110010100, 0b1111111110010101, 0b1111111110010110},
{0b0, 0b111010, 0b111110110, 0b1111111110010111, 0b1111111110011000, 0b1111111110011001, 0b1111111110011010, 0b1111111110011011, 0b1111111110011100, 0b1111111110011101, 0b1111111110011110},
{0b0, 0b111011, 0b1111111001, 0b1111111110011111, 0b1111111110100000, 0b1111111110100001, 0b1111111110100010, 0b1111111110100011, 0b1111111110100100, 0b1111111110100101, 0b1111111110100110},
{0b0, 0b1111001, 0b11111110111, 0b1111111110100111, 0b1111111110101000, 0b1111111110101001, 0b1111111110101010, 0b1111111110101011, 0b1111111110101100, 0b1111111110101101, 0b1111111110101110},
{0b0, 0b1111010, 0b11111111000, 0b1111111110101111, 0b1111111110110000, 0b1111111110110001, 0b1111111110110010, 0b1111111110110011, 0b1111111110110100, 0b1111111110110101, 0b1111111110110110},
{0b0, 0b11111001, 0b1111111110110111, 0b1111111110111000, 0b1111111110111001, 0b1111111110111010, 0b1111111110111011, 0b1111111110111100, 0b1111111110111101, 0b1111111110111110, 0b1111111110111111},
{0b0, 0b111110111, 0b1111111111000000, 0b1111111111000001, 0b1111111111000010, 0b1111111111000011, 0b1111111111000100, 0b1111111111000101, 0b1111111111000110, 0b1111111111000111, 0b1111111111001000},
{0b0, 0b111111000, 0b1111111111001001, 0b1111111111001010, 0b1111111111001011, 0b1111111111001100, 0b1111111111001101, 0b1111111111001110, 0b1111111111001111, 0b1111111111010000, 0b1111111111010001},
{0b0, 0b111111001, 0b1111111111010010, 0b1111111111010011, 0b1111111111010100, 0b1111111111010101, 0b1111111111010110, 0b1111111111010111, 0b1111111111011000, 0b1111111111011001, 0b1111111111011010},
{0b0, 0b111111010, 0b1111111111011011, 0b1111111111011100, 0b1111111111011101, 0b1111111111011110, 0b1111111111011111, 0b1111111111100000, 0b1111111111100001, 0b1111111111100010, 0b1111111111100011},
{0b0, 0b11111111001, 0b1111111111100100, 0b1111111111100101, 0b1111111111100110, 0b1111111111100111, 0b1111111111101000, 0b1111111111101001, 0b1111111111101010, 0b1111111111101011, 0b1111111111101100},
{0b0, 0b11111111100000, 0b1111111111101101, 0b1111111111101110, 0b1111111111101111, 0b1111111111110000, 0b1111111111110001, 0b1111111111110010, 0b1111111111110011, 0b1111111111110100, 0b1111111111110101},
{0b1111111010, 0b111111111000011, 0b1111111111110110, 0b1111111111110111, 0b1111111111111000, 0b1111111111111001, 0b1111111111111010, 0b1111111111111011, 0b1111111111111100, 0b1111111111111101, 0b1111111111111110}};







static const char DC_tree_Luma[16] = {  0x00,0x01 ,0x05 ,0x01 ,0x01 ,0x01 ,0x01 ,0x01 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00};
static const char DC_values_Luma[16] = {0x00 ,0x01 ,0x02 ,0x03 ,0x04 ,0x05 ,0x06 ,0x07 ,0x08 ,0x09 ,0x0A ,0x0B ,0x00 ,0x00 ,0x00 ,0x00};
static const unsigned char ENCODING_DC_codeLen_Luma[12] = {2,4,5,6,7,8,10,12,14,16,18,20};
static const char* ENCODING_DC_code_Luma[12] = {"00","010","011","100","101","110","1110","11110","111110","1111110","11111110","111111110"};
static const unsigned int bin_DC_code_Luma[12] = {0b00,0b010,0b011,0b100,0b101,0b110,0b1110,0b11110,0b111110,0b1111110,0b11111110,0b111111110};


static const char DC_tree_Chroma[16] = {0,3 ,1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,0,0};
static const char DC_values_Chroma[16] = {0x00 ,0x01 ,0x02 ,0x03 ,0x04 ,0x05 ,0x06 ,0x07 ,0x08 ,0x09 ,0x0A ,0x0B ,0x00 ,0x00 ,0x00 ,0x00};
static const unsigned char ENCODING_DC_codeLen_Chroma[12] = {2, 3, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22};
static const char* ENCODING_DC_code_Chroma[12] = {"00", "01", "10", "110", "1110", "11110", "111110", "1111110", "11111110", "111111110", "1111111110", "11111111110"};
static const unsigned int bin_DC_code_Chroma[12] = {0b00,0b01,0b10,0b110,0b1110,0b11110,0b111110,0b1111110,0b11111110,0b111111110,0b1111111110,0b11111111110};



typedef struct {
	unsigned char zeros;
	unsigned char len;
} symbol;



int encode(int x_image_size, int y_image_size, int *img_data , unsigned char * code, char encoding_type, int bit_offset);








#endif /* HUFFMAN_H_ */
